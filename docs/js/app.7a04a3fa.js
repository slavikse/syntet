(function(e){function t(t){for(var i,s,o=t[0],c=t[1],l=t[2],p=0,d=[];p<o.length;p++)s=o[p],Object.prototype.hasOwnProperty.call(a,s)&&a[s]&&d.push(a[s][0]),a[s]=0;for(i in c)Object.prototype.hasOwnProperty.call(c,i)&&(e[i]=c[i]);u&&u(t);while(d.length)d.shift()();return r.push.apply(r,l||[]),n()}function n(){for(var e,t=0;t<r.length;t++){for(var n=r[t],i=!0,o=1;o<n.length;o++){var c=n[o];0!==a[c]&&(i=!1)}i&&(r.splice(t--,1),e=s(s.s=n[0]))}return e}var i={},a={app:0},r=[];function s(t){if(i[t])return i[t].exports;var n=i[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=e,s.c=i,s.d=function(e,t,n){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},s.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)s.d(n,i,function(t){return e[t]}.bind(null,i));return n},s.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="/";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],c=o.push.bind(o);o.push=t,o=o.slice();for(var l=0;l<o.length;l++)t(o[l]);var u=c;r.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("56d7")},1:function(e,t){},"19d0":function(e,t,n){"use strict";var i=n("6cda"),a=n.n(i);a.a},2:function(e,t){},3:function(e,t){},4:function(e,t){},"40b2":function(e,t,n){},5:function(e,t){},"553a":function(e,t,n){},"56d7":function(e,t,n){"use strict";n.r(t);n("e260"),n("e6cf"),n("cca6"),n("a79d");var i=n("2b0e"),a=n("8c4f"),r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"App"},[n("div",{staticClass:"routers"},[n("div",{staticClass:"title"},[e._v(" –ü–†–û–ï–ö–¢–´ ")]),n("div",{staticClass:"buttons"},[n("router-link",{staticClass:"route",attrs:{to:{name:"TicTacToe"}}},[e._v(" –ö—Ä–µ—Å—Ç–∏–∫–∏ –Ω–æ–ª–∏–∫–∏ "),n("span",[e._v("(–ó–∞–≤–µ—Ä—à—ë–Ω)")]),n("a",{staticClass:"link",attrs:{href:"https://habr.com/ru/post/505574",target:"_blank"},on:{click:function(e){e.stopPropagation()}}},[e._v(" _–°—Ç–∞—Ç—å—è__ ")])]),n("router-link",{staticClass:"route",attrs:{to:{name:"Square"}}},[e._v(" –ö–≤–∞–¥—Ä–∞—Ç –≤ –ª–∞–±–∏—Ä–∏–Ω—Ç–µ "),n("span",[e._v("(–ó–∞–≤–µ—Ä—à—ë–Ω)")]),n("a",{staticClass:"link",attrs:{href:"https://habr.com/ru/post/452612",target:"_blank"},on:{click:function(e){e.stopPropagation()}}},[e._v(" _–°—Ç–∞—Ç—å—è__ ")])]),n("router-link",{staticClass:"route",attrs:{to:{name:"Snake"}}},[e._v(" –ó–º–µ–π–∫–∞ "),n("span",[e._v("(–í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ)")])])],1)]),n("router-view")],1)},s=[],o=(n("b0c0"),{name:"App",data:function(){return{previousRouteName:localStorage.getItem("previousRouteName")}},watch:{$route:function(e){e.meta.isReload&&e.name!==this.previousRouteName&&(localStorage.setItem("previousRouteName",e.name),window.location.reload())}}}),c=o,l=(n("19d0"),n("2877")),u=Object(l["a"])(c,r,s,!1,null,"6bbdaab8",null),p=u.exports,d=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"TicTacToe"},[n("div",{staticClass:"stat"},[n("div",{staticClass:"title"},[n("span",[e._v("–ü–æ–±–µ–¥—ã –≤ —Å–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏—è—Ö:")]),n("span",{staticClass:"X"},[e._v(" X ")]),n("span",{staticClass:"victory"},[e._v(" "+e._s(e.victories.X)+" ")]),e._v(" Àë "),n("span",{staticClass:"O"},[e._v(" O ")]),n("span",{staticClass:"victory"},[e._v(" "+e._s(e.victories.O)+" ")])]),n("div",{staticClass:"description"},[e._v(" –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ –∏ —Å–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏–π: "+e._s(e.trainingGames+e.duelGames)+" ")]),n("div",{staticClass:"timer"},[e._v(" –í—Ä–µ–º—è –æ–±—É—á–µ–Ω–∏—è: "+e._s(e.timer)+" —Å–µ–∫—É–Ω–¥ (~"+e._s(Math.round(e.timer/60))+" –º–∏–Ω—É—Ç) ")])]),n("div",{staticClass:"fields-container"},[n("div",{staticClass:"fields"},e._l(e.agents.X.concat(e.agents.O),(function(t,i){return n("div",{key:i,staticClass:"field"},[e._l(t.field,(function(a,r){return n("div",{key:i+":"+r,class:["cell",{sign:a,alive:t.isAlive,victory:t.isVictory}]},[e._v(" "+e._s(a)+" ")])})),n("div",{staticClass:"caption"},[e._v(" –ü–æ–ª–µ –∏–≥—Ä–æ–∫–∞: "+e._s(t.sign)+" ")])],2)})),0),n("div",{staticClass:"duel-field"},[e._l(e.duel.field,(function(t,i){return n("div",{key:i,class:["cell",t,{victory:e.victoriesStatus[t]}]},[e._v(" "+e._s(t)+" ")])})),n("div",{staticClass:"caption"},[e._v(" –ü–æ–ª–µ –¥–ª—è —Å–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏–π ")])],2)]),e._m(0),n("div",{staticClass:"ai-vs-human-container"},[n("div",{staticClass:"result"},[n("span",{staticClass:"X"},[e._v(" X ")]),n("span",{class:[e.AIvsHuman.victories.X>=0?"success":"loss"]},[e._v(" "+e._s(e.AIvsHuman.victories.X)+" ")]),e._v(" Àë "),n("span",{staticClass:"O"},[e._v(" O ")]),n("span",{class:[e.AIvsHuman.victories.O>=0?"success":"loss"]},[e._v(" "+e._s(e.AIvsHuman.victories.O)+" ")])]),n("div",{staticClass:"caption"},[e._v(" –ß–µ–ª–æ–≤–µ–∫ –ø—Ä–æ—Ç–∏–≤ AI ")]),n("div",{staticClass:"field"},e._l(e.AIvsHuman.field,(function(t,i){return n("div",{key:i,class:["cell",t,{victory:e.victoriesStatus[t]}],on:{click:function(t){return e.setHumanSign(i)}}},[e._v(" "+e._s(t)+" ")])})),0),n("button",{class:["resume","button",{"is-duel":e.AIvsHuman.isDuel}],on:{click:e.AIvsHumanReset}},[e._v(" –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –æ–±—É—á–µ–Ω–∏–µ ")]),n("div",{staticClass:"models-controller"},[n("div",{staticClass:"button-container"},[n("button",{staticClass:"button",on:{click:e.saveModelsOnPC}},[e._v(" –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –º–æ–¥–µ–ª–∏ –Ω–∞ –∫–æ–º–ø—å—é—Ç–µ—Ä ")])]),n("div",{staticClass:"button-container"},[n("button",{staticClass:"button",on:{click:e.localStorageClear}},[e._v(" –û—á–∏—Å—Ç–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ ")])]),n("div",{staticClass:"button-container"},[n("button",{staticClass:"button",on:{click:e.restoreModelsFromGitHub}},[e._v(" –í–≤–µ—Å—Ç–∏ –º–æ–¥–µ–ª–∏ –∏–∑ GitHub ")])])])])])},m=[function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"fields-description"},[n("div",[e._v("9 –∏–≥—Ä - –∏–≥—Ä–æ–∫–∏ –Ω–∞ —Å–≤–æ–∏—Ö –ø–æ–ª—è—Ö —É—á–∞—Ç—Å—è –∏–≥—Ä–∞—Ç—å, 1 –∏–≥—Ä–∞ - —Å–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏–µ.")]),n("br"),n("b",[e._v("–ù–∞—á–∞—Ç—å –∏–≥—Ä—É —Å AI –º–æ–∂–Ω–æ –ø–æ—Å—Ç–∞–≤–∏–≤ –∑–Ω–∞–∫ –Ω–∞ –ø–æ–ª–µ –Ω–∏–∂–µ - –æ–±—É—á–µ–Ω–∏–µ –ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è.")])])}],f=(n("99af"),n("4de4"),n("4160"),n("c975"),n("d81d"),n("a434"),n("d3b7"),n("3ca3"),n("159b"),n("ddb0"),n("4795"),n("5530")),v=n("2909"),h=n("3835"),g=(n("96cf"),n("1da1")),b=n("ce1a");function x(e){for(var t=e.field,n=e.sign,i=0,a=0;a<t.length;a++){if(t[a]===n)i+=1;else{i=0;while(a%3+1!==3)a+=1}if(3===i)return!0}return!1}function w(e){for(var t=e.field,n=e.sign,i=e.start,a=e.step,r=0,s=0,o=i;o<t.length;o++){if(t[o]===n)r+=1,1===r&&(s=o),o+=a;else if(0!==r&&(o=s),r=0,2===o)break;if(3===r)return!0}return!1}function y(e){var t=e.field,n=e.sign;return w({field:t,sign:n,start:0,step:3})||w({field:t,sign:n,start:2,step:1})}var O=!0,_=!0,k=!1,T=-1,R=-.4,S=.1,C=.2,j=.5,A=1,I=11,H={name:"TicTacToe",data:function(){return{modelX:b["c"](),modelO:b["c"](),trainingCount:{X:0,O:0},training:{X:{inputs:[],labels:[]},O:{inputs:[],labels:[]}},agents:{X:[],O:[]},victories:{X:0,O:0},victoriesStatus:{X:!1,O:!1},fieldSize:9,step:1,trainingGames:1,timer:0,timeTraining:300,isDuel:!1,duel:{step:1,field:["","","","","","","","",""]},duelGames:1,AIvsHuman:{isDuel:!1,step:1,victories:{X:0,O:0},rewards:[.1,.1,.1,.1,.1,.1,.1,.1,.1],field:["","","","","","","","",""]}}},mounted:function(){var e=this;return Object(g["a"])(regeneratorRuntime.mark((function t(){var n,i,a,r,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(console.log(I),n=JSON.parse(localStorage.getItem("syntet_TicTacToe_timer")),!n){t.next=18;break}return e.timer=n,e.restoreFromLocalStorage(),t.next=7,Promise.all([b["b"]("localstorage://syntet_TicTacToe_model_X"),b["b"]("localstorage://syntet_TicTacToe_model_O")]);case 7:i=t.sent,a=Object(h["a"])(i,2),r=a[0],s=a[1],localStorage.clear(),r.compile({optimizer:"adam",loss:"meanSquaredError"}),s.compile({optimizer:"adam",loss:"meanSquaredError"}),e.modelX=r,e.modelO=s,t.next=20;break;case 18:e.setupModel({model:e.modelX}),e.setupModel({model:e.modelO});case 20:e.agentsSetting({sign:"X"}),e.agentsSetting({sign:"O"}),e.setTimer(),O&&e.gameLoop();case 24:case"end":return t.stop()}}),t)})))()},methods:{restoreFromLocalStorage:function(){this.trainingCount=JSON.parse(localStorage.getItem("syntet_TicTacToe_trainingCount")),this.victories=JSON.parse(localStorage.getItem("syntet_TicTacToe_victories")),this.trainingGames=JSON.parse(localStorage.getItem("syntet_TicTacToe_trainingGames")),this.duelGames=JSON.parse(localStorage.getItem("syntet_TicTacToe_duelGames")),this.AIvsHuman.victories=JSON.parse(localStorage.getItem("syntet_TicTacToe_AIvsHuman_victories"))},setupModel:function(e){var t=e.model;t.add(b["a"].dense({inputShape:[this.fieldSize+1],activation:"sigmoid",units:128})),t.add(b["a"].dense({activation:"sigmoid",units:this.fieldSize})),t.compile({optimizer:"adam",loss:"meanSquaredError"})},agentsSetting:function(e){var t=e.sign;this.agents[t]=[{sign:t,isAlive:!0,isVictory:!1,rewards:[.1,.1,.1,.1,.1,.1,.1,.1,.1],field:["","","","","","","","",""]}]},setTimer:function(){setTimeout(this.setTimer,1e3),this.timer+=1},gameLoop:function(){var e=this;return Object(g["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!e.AIvsHuman.isDuel){t.next=7;break}return e.agentsSetting({sign:"X"}),e.agentsSetting({sign:"O"}),t.next=5,new Promise((function(e){return setTimeout(e,300)}));case 5:return e.gameLoop(),t.abrupt("return");case 7:if(!e.isDuel||!_){t.next=13;break}return t.next=10,e.startDuel();case 10:e.duelGames+=1,t.next=17;break;case 13:return e.isDuel=e.trainingGames%e.fieldSize===0,t.next=16,e.startTraining();case 16:e.trainingGames+=1;case 17:if(!k){t.next=20;break}return t.next=20,new Promise((function(e){return setTimeout(e,300)}));case 20:if(0===e.timer||e.timer%e.timeTraining!==0){t.next=25;break}return e.saveInLocalStorage(),t.next=24,e.saveModelsLocal();case 24:window.location.reload();case 25:e.gameLoop();case 26:case"end":return t.stop()}}),t)})))()},saveInLocalStorage:function(){localStorage.setItem("syntet_TicTacToe_timer",JSON.stringify(this.timer)),localStorage.setItem("syntet_TicTacToe_trainingCount",JSON.stringify(this.trainingCount)),localStorage.setItem("syntet_TicTacToe_victories",JSON.stringify(this.victories)),localStorage.setItem("syntet_TicTacToe_trainingGames",JSON.stringify(this.trainingGames)),localStorage.setItem("syntet_TicTacToe_duelGames",JSON.stringify(this.duelGames)),localStorage.setItem("syntet_TicTacToe_AIvsHuman_victories",JSON.stringify(this.AIvsHuman.victories))},saveModelsLocal:function(){var e=this;return Object(g["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.modelX.save("localstorage://syntet_TicTacToe_model_X");case 2:return t.next=4,e.modelO.save("localstorage://syntet_TicTacToe_model_O");case 4:case"end":return t.stop()}}),t)})))()},startDuel:function(){var e=this;return Object(g["a"])(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n=2,t.next=3,new Promise((function(t){var i=e.agents.X.filter((function(e){var t=e.isAlive;return t})),a=i.length;a>0?i.forEach(function(){var n=Object(g["a"])(regeneratorRuntime.mark((function n(i){return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,e.modelPredict({model:e.modelX,agent:i});case 2:a-=1,0===a&&t();case 4:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}()):(n-=1,t())}));case 3:return t.next=5,new Promise((function(t){var i=e.agents.O.filter((function(e){var t=e.isAlive;return t})),a=i.length;a>0?i.forEach(function(){var n=Object(g["a"])(regeneratorRuntime.mark((function n(i){return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,e.modelPredict({model:e.modelO,agent:i});case 2:a-=1,0===a&&t();case 4:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}()):(n-=1,t())}));case 5:if(2===n&&(e.duel.step=e.fieldSize),e.duel.step!==e.fieldSize){t.next=13;break}return t.next=9,Promise.all([e.modelFit({model:e.modelX,sign:"X"}),e.modelFit({model:e.modelO,sign:"O"})]);case 9:e.isDuel=!1,e.duel={step:1,field:["","","","","","","","",""]},t.next=14;break;case 13:e.duel.step+=1;case 14:case"end":return t.stop()}}),t)})))()},startTraining:function(){var e=this;return Object(g["a"])(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(n=e.agents.X.filter((function(e){var t=e.isAlive;return t})).map((function(t){return e.modelPredict({model:e.modelX,agent:t})})).concat(e.agents.O.filter((function(e){var t=e.isAlive;return t})).map((function(t){return e.modelPredict({model:e.modelO,agent:t})}))),0!==n.length){t.next=5;break}e.step=e.fieldSize,t.next=7;break;case 5:return t.next=7,Promise.all(n);case 7:if(e.step!==e.fieldSize){t.next=13;break}return t.next=10,Promise.all([e.modelFit({model:e.modelX,sign:"X"}),e.modelFit({model:e.modelO,sign:"O"})]);case 10:e.step=1,t.next=14;break;case 13:e.step+=1;case 14:case"end":return t.stop()}}),t)})))()},modelPredict:function(e){var t=this;return Object(g["a"])(regeneratorRuntime.mark((function n(){var i,a,r,s,o,c,l,u,p;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return i=e.model,a=e.agent,r=t.isDuel?t.duel.step:t.step,s=t.isDuel?t.duel.field:a.field,t.increasingInterest({field:s,agent:a}),o=t.getStepInput(r),n.next=7,i.predict(b["d"]([a.rewards.concat([o])])).data();case 7:c=n.sent,l=c.indexOf(Math.max.apply(Math,Object(v["a"])(c))),0===s[l].length?(u=a.sign,s.splice(l,1,u),a.rewards=t.recalculateRewards({rewards:a.rewards,field:s}),p=t.determineWinner({field:s,sign:u}),p?(a.isAlive=!1,a.isVictory=!0,a.rewards[l]=A,t.saveTraining({type:"winner",field:s,agent:a,stepInput:o}),t.isDuel&&(t.victories[u]+=1,t.victoriesStatus[u]=!0)):(a.rewards[l]=S,t.saveTraining({type:"step",field:s,agent:a,stepInput:o}))):(a.isAlive=!1,a.rewards=t.recalculateRewards({rewards:a.rewards,field:s}),t.saveTraining({type:"loss",field:s,agent:a,stepInput:o}));case 10:case"end":return n.stop()}}),n)})))()},increasingInterest:function(e){for(var t=e.field,n=e.agent,i="X"===n.sign?"O":"X",a=0;a<t.length;a+=1)if(0===t[a].length){t.splice(a,1,n.sign);var r=this.determineWinner({field:t,sign:n.sign});if(t.splice(a,1,""),r){n.rewards[a]=A;break}t.splice(a,1,i);var s=this.determineWinner({field:t,sign:i});if(t.splice(a,1,""),s){n.rewards[a]=j;break}}},getStepInput:function(e){return 1-e/this.fieldSize},recalculateRewards:function(e){var t=e.rewards,n=e.field;return t.map((function(e,t){var i;return i=0===n[t].length?S:T,i}))},determineWinner:function(e){var t=e.field,n=e.sign;return x({field:t,sign:n})||w({field:t,sign:n,start:0,step:2})||y({field:t,sign:n})},saveTraining:function(e){var t=this,n=e.type,i=e.field,a=e.agent,r=e.stepInput,s=a.sign,o=a.rewards,c=i.map((function(e){return t.trafficLights({type:n,sign:s,cell:e})})).concat([r]);this.training[s].inputs.push(c),this.training[s].labels.push(o),this.trainingCount[s]+=1},trafficLights:function(e){var t=e.type,n=e.sign,i=e.cell,a=S;return"winner"===t?a=n===i?A:0===i.length?S:T:"step"===t?a=n===i?C:0===i.length?S:T:"loss"===t&&(a=n===i?R:0===i.length?S:T),a},modelFit:function(e){var t=this;return Object(g["a"])(regeneratorRuntime.mark((function n(){var i,a;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(i=e.model,a=e.sign,!(t.trainingCount[a]>0)){n.next=11;break}if(0!==t.training[a].inputs.length&&0!==t.training[a].labels.length){n.next=4;break}return n.abrupt("return");case 4:return t.trainingCount[a]=0,t.victoriesStatus[a]=!1,n.next=8,i.fit(b["d"](t.training[a].inputs),b["d"](t.training[a].labels));case 8:t.trainingReset(a),t.agentsSetting({sign:"X"}),t.agentsSetting({sign:"O"});case 11:case"end":return n.stop()}}),n)})))()},trainingReset:function(e){this.training[e].inputs=[],this.training[e].labels=[]},setHumanSign:function(e){var t=this;return Object(g["a"])(regeneratorRuntime.mark((function n(){var i,a;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return t.AIvsHuman.isDuel||(t.AIvsHuman.isDuel=!0,t.trainingReset("X"),t.trainingReset("O")),n.next=3,t.humanSignXO({sign:"X",cIndex:e});case 3:if(i=n.sent,a=i.isPass,!a){n.next=8;break}return n.next=8,t.humanSignXO({sign:"O",cIndex:-1});case 8:case"end":return n.stop()}}),n)})))()},humanSignXO:function(e){var t=this;return Object(g["a"])(regeneratorRuntime.mark((function n(){var i,a,r,s,o,c,l,u,p;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(i=e.sign,a=e.cIndex,!(t.AIvsHuman.step>t.fieldSize)){n.next=4;break}return t.AIvsHumanReset(),n.abrupt("return",{isPass:!1});case 4:if(t.AIvsHuman.step+=1,r=t.getStepInput(t.AIvsHuman.step),s=t.AIvsHuman.field,o=a,"O"!==i){n.next=14;break}return t.increasingInterest({field:s,agent:t.AIvsHuman}),n.next=12,t.modelO.predict(b["d"]([t.AIvsHuman.rewards.concat([r])])).data();case 12:c=n.sent,o=c.indexOf(Math.max.apply(Math,Object(v["a"])(c)));case 14:if(0!==s[o].length){n.next=27;break}if(s.splice(o,1,i),t.AIvsHuman.rewards=t.recalculateRewards({rewards:t.AIvsHuman.rewards,field:s}),l=t.determineWinner({field:s,sign:i}),!l){n.next=25;break}return u={sign:i,rewards:t.AIvsHuman.rewards},t.saveTraining({type:"winner",field:s,agent:u,stepInput:r}),t.AIvsHuman.victories[i]+=1,n.next=24,t.AIvsHumanFit();case 24:return n.abrupt("return",{isPass:!1});case 25:n.next=34;break;case 27:return t.AIvsHuman.rewards=t.recalculateRewards({rewards:t.AIvsHuman.rewards,field:s}),p={sign:i,rewards:t.AIvsHuman.rewards},t.saveTraining({type:"loss",field:s,agent:p,stepInput:r}),t.AIvsHuman.victories[i]-=1,n.next=33,t.AIvsHumanFit();case 33:return n.abrupt("return",{isPass:!1});case 34:return n.abrupt("return",{isPass:!0});case 35:case"end":return n.stop()}}),n)})))()},AIvsHumanFit:function(){var e=this;return Object(g["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Promise.all([e.modelFit({model:e.modelX,sign:"X"}),e.modelFit({model:e.modelO,sign:"O"})]);case 2:e.AIvsHumanReset();case 3:case"end":return t.stop()}}),t)})))()},AIvsHumanReset:function(){this.AIvsHuman=Object(f["a"])(Object(f["a"])({},this.AIvsHuman),{},{isDuel:!1,step:1,rewards:[.1,.1,.1,.1,.1,.1,.1,.1,.1],field:["","","","","","","","",""]})},saveModelsOnPC:function(){var e=this;return Object(g["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,Promise.all([e.modelX.save("downloads://syntet_TicTacToe_model_X"),e.modelO.save("downloads://syntet_TicTacToe_model_O")]);case 3:t.next=8;break;case 5:t.prev=5,t.t0=t["catch"](0),console.error("saveModels",t.t0);case 8:case"end":return t.stop()}}),t,null,[[0,5]])})))()},localStorageClear:function(){localStorage.clear()},restoreModelsFromGitHub:function(){var e=this;return Object(g["a"])(regeneratorRuntime.mark((function t(){var n,i,a,r,s,o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n="./models/syntet_TicTacToe_model_X.json",i="./models/syntet_TicTacToe_model_O.json",t.next=4,Promise.all([b["b"](n),b["b"](i)]);case 4:a=t.sent,r=Object(h["a"])(a,2),s=r[0],o=r[1],s.compile({optimizer:"adam",loss:"meanSquaredError"}),o.compile({optimizer:"adam",loss:"meanSquaredError"}),e.modelX=s,e.modelO=o;case 12:case"end":return t.stop()}}),t)})))()}}},L=H,M=(n("e526"),Object(l["a"])(L,d,m,!1,null,"555fc43e",null)),P=M.exports,X=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("div",{staticClass:"stat"},[e._v(" –ñ–∏–≤—ã—Ö: "+e._s(e.alives)+" | –ü–æ–∫–æ–ª–µ–Ω–∏–π: "+e._s(e.generation)+" | –ü–æ–±–µ–¥—ã: "+e._s(e.victories)+" ")]),n("div",{ref:"container",staticClass:"container",attrs:{tabindex:"0"},on:{keyup:[function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"up",38,t.key,["Up","ArrowUp"])?null:e.handleJumpTop(t)},function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"right",39,t.key,["Right","ArrowRight"])||"button"in t&&2!==t.button?null:e.handleJumpRight(t)},function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"down",40,t.key,["Down","ArrowDown"])?null:e.handleJumpBottom(t)},function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"left",37,t.key,["Left","ArrowLeft"])||"button"in t&&0!==t.button?null:e.handleJumpLeft(t)}]}},[n("div",{staticClass:"field cells"},e._l(e.field,(function(t,i){return n("div",{key:i,class:["cell",{available:0!==t}]},[1===t?n("div",{staticClass:"starting-checkpoint"},[e._v(" ü•æ ")]):e._e(),t===e.investigatedMaximumCellValue||e.investigatedMaximumCellValue===e.maximumCellValue?n("div",{staticClass:"maximum-cell-value-checkpoint"},[e._v(" ü§ò ")]):e._e(),t===e.maximumCellValue?n("div",{staticClass:"finishing-checkpoint"},[e._v(" üß† ")]):e._e()])})),0),e.isDisplayingActors?n("div",{staticClass:"field actors"},e._l(e.actors,(function(t){return n("div",{key:t.id,style:{gridRow:t.y,gridColumn:t.x}},[n("div",{ref:"actors_"+t.id,refInFor:!0,staticClass:"actor"},[n("div",[e._v("üë£Ô∏è")])])])})),0):e._e()])])},E=[],z=!0,D=!0,V=500,F=5,B=V/F,J=0,N={name:"Square",data:function(){return{model:b["c"](),training:{inputs:[],labels:[]},learning:{inputs:[],labels:[]},generation:0,victories:0,isDisplayingActors:D,actors:[],alives:V,investigatedMaximumCellValue:1,field:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,45,44,43,0,0,2,0,0,0,0,0,0,0,0,0,42,0,0,3,0,0,8,9,10,11,0,0,0,41,0,0,4,5,6,7,0,0,12,0,0,0,40,0,0,0,0,0,0,0,0,13,0,0,0,39,0,0,0,0,0,0,0,15,14,0,0,0,38,0,0,0,0,0,0,0,16,0,0,0,0,37,0,0,0,21,20,19,18,17,0,0,0,0,36,0,0,0,22,0,0,0,0,0,0,33,34,35,0,0,0,23,0,0,0,0,0,0,32,0,0,0,0,0,24,25,26,27,28,29,30,31,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],fieldSize:-1,maximumCellValue:-1}},mounted:function(){var e=this;return Object(g["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.setupModel(),e.fieldSetting(),t.next=4,e.actorsSetting();case 4:if(!z){t.next=7;break}return t.next=7,e.modelPredict();case 7:case"end":return t.stop()}}),t)})))()},methods:{setupModel:function(){this.model.add(b["a"].dense({inputShape:[3],activation:"sigmoid",units:256})),this.model.add(b["a"].dropout({rate:.1})),this.model.add(b["a"].dense({activation:"sigmoid",units:128})),this.model.add(b["a"].dense({activation:"sigmoid",units:4})),this.model.compile({optimizer:b["e"].adam(.01),loss:"meanSquaredError",metrics:["accuracy"]})},fieldSetting:function(){this.fieldSize=Math.sqrt(this.field.length),this.maximumCellValue=Math.max.apply(Math,Object(v["a"])(this.field)),this.$refs.container.style.setProperty("--quantity-rows",this.fieldSize),this.$refs.container.style.setProperty("--quantity-columns",this.fieldSize)},actorsSetting:function(){var e=this;return Object(g["a"])(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:for(n=0;n<V;n++)e.actors.push({id:n,style:void 0,x:2,y:2,cellValue:1});if(!D){t.next=5;break}return t.next=4,e.$nextTick();case 4:e.actors.forEach((function(t){var n=Object(h["a"])(e.$refs["actors_".concat(t.id)],1),i=n[0].style;t.style=i}));case 5:case"end":return t.stop()}}),t)})))()},actorsReset:function(){for(var e=0;e<V;e++)this.actors[e].x=2,this.actors[e].y=2,this.actors[e].cellValue=1;this.alives=V},modelPredict:function(){var e=this;return Object(g["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Promise.all(e.actors.map(function(){var t=Object(g["a"])(regeneratorRuntime.mark((function t(n){var i,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(0===n.cellValue){t.next=14;break}if(J+=1,J!==B){t.next=7;break}i=e.getRandomPredict(),J=0,t.next=10;break;case 7:return t.next=9,e.model.predict(b["d"]([[n.x/e.fieldSize,n.y/e.fieldSize,n.cellValue/e.maximumCellValue]])).data();case 9:i=t.sent;case 10:return a=e.getDirectionStep(i),e[a](n),t.next=14,e.availabilityCheck(n);case 14:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()));case 2:return t.next=4,e.modelPredict();case 4:case"end":return t.stop()}}),t)})))()},getRandomPredict:function(){return[Math.random(),Math.random(),Math.random(),Math.random()]},getDirectionStep:function(e){var t=Object(h["a"])(e,4),n=t[0],i=t[1],a=t[2],r=t[3],s=n,o="jumpTop";return i>s&&(s=i,o="jumpRight"),a>s&&(s=a,o="jumpBottom"),r>s&&(o="jumpLeft"),o},jumpTop:function(e){e.y-=1},jumpRight:function(e){e.x+=1},jumpBottom:function(e){e.y+=1},jumpLeft:function(e){e.x-=1},availabilityCheck:function(e){var t=this;return Object(g["a"])(regeneratorRuntime.mark((function n(){var i,a,r;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(i=e.y-1,a=e.x-1,r=t.field[i*t.fieldSize+a],!(r>e.cellValue)){n.next=13;break}if(e.cellValue=r,r>t.investigatedMaximumCellValue&&(t.investigatedMaximumCellValue=r),r!==t.maximumCellValue){n.next=11;break}return t.victories+=1,n.next=10,t.actorsReset();case 10:return n.abrupt("return");case 11:n.next=15;break;case 13:e.cellValue=0,t.alives-=1;case 15:if(t.saveTraining({actor:e,label:t.getAntennaCellValues({normalX:a,normalY:i})}),0!==t.alives){n.next=19;break}return n.next=19,t.modelFit();case 19:case"end":return n.stop()}}),n)})))()},getAntennaCellValues:function(e){var t=e.normalX,n=e.normalY,i=this.field[(n-1)*this.fieldSize+t]||0,a=this.field[n*this.fieldSize+(t+1)]||0,r=this.field[(n+1)*this.fieldSize+t]||0,s=this.field[n*this.fieldSize+(t-1)]||0;return[i/this.maximumCellValue,a/this.maximumCellValue,r/this.maximumCellValue,s/this.maximumCellValue]},saveTraining:function(e){var t=e.actor,n=e.label;this.training.inputs.push([t.x/this.fieldSize,t.y/this.fieldSize,t.cellValue/this.maximumCellValue]),this.training.labels.push(n)},modelFit:function(){var e=this;return Object(g["a"])(regeneratorRuntime.mark((function t(){var n,i,a,r,s,o,c,l,u,p,d;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n=e.getBestMoves(),i=n.firstInput,a=n.firstLabel,r=n.secondInput,s=n.secondLabel,o=n.thirdInput,c=n.thirdLabel,l=n.fourInput,u=n.fourLabel,p=n.fiveInput,d=n.fiveLabel,e.learning.inputs.push(i,r,o,l,p),e.learning.labels.push(a,s,c,u,d),t.next=5,e.model.fit(b["d"](e.learning.inputs),b["d"](e.learning.labels));case 5:return e.generation+=1,t.next=8,e.actorsReset();case 8:case"end":return t.stop()}}),t)})))()},getBestMoves:function(){var e=this.training,t=e.inputs,n=e.labels;this.training={inputs:[],labels:[]};var i=-1,a=-1,r=-1,s=-1,o=-1,c=-1,l=-1,u=-1,p=-1,d=-1;return t.forEach((function(e,t){var n=Object(h["a"])(e,3),m=n[2];switch(!0){case m>o:i=a,a=r,r=s,s=o,o=m,c=l,l=u,u=p,p=d,d=t;break;case m>s:i=a,a=r,r=s,s=m,c=l,l=u,u=p,p=t;break;case m>r:i=a,a=r,r=m,c=l,l=u,u=t;break;case m>a:i=a,a=m,c=l,l=t;break;case m>i:i=m,c=t;break;default:}})),{firstInput:t[d],firstLabel:n[d],secondInput:t[p],secondLabel:n[p],thirdInput:t[u],thirdLabel:n[u],fourInput:t[l],fourLabel:n[l],fiveInput:t[c],fiveLabel:n[c]}},handleJumpTop:function(){var e=this;return Object(g["a"])(regeneratorRuntime.mark((function t(){var n,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n=Object(h["a"])(e.actors,1),i=n[0],e.jumpTop(i),t.next=4,e.availabilityCheck(i);case 4:case"end":return t.stop()}}),t)})))()},handleJumpRight:function(){var e=this;return Object(g["a"])(regeneratorRuntime.mark((function t(){var n,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n=Object(h["a"])(e.actors,1),i=n[0],e.jumpRight(i),t.next=4,e.availabilityCheck(i);case 4:case"end":return t.stop()}}),t)})))()},handleJumpBottom:function(){var e=this;return Object(g["a"])(regeneratorRuntime.mark((function t(){var n,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n=Object(h["a"])(e.actors,1),i=n[0],e.jumpBottom(i),t.next=4,e.availabilityCheck(i);case 4:case"end":return t.stop()}}),t)})))()},handleJumpLeft:function(){var e=this;return Object(g["a"])(regeneratorRuntime.mark((function t(){var n,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n=Object(h["a"])(e.actors,1),i=n[0],e.jumpLeft(i),t.next=4,e.availabilityCheck(i);case 4:case"end":return t.stop()}}),t)})))()}}},G=N,q=(n("e867"),Object(l["a"])(G,X,E,!1,null,"1da70bd2",null)),$=q.exports,Y=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"Snake"},[n("div",{staticClass:"text-container"},[n("div",{staticClass:"message"},[e._v(" –†—É—á–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ WASD ")]),n("div",{staticClass:"steps-count"},[e._v(" –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Å—Ç–∞–≤—à–∏—Ö—Å—è —Ö–æ–¥–æ–≤: "+e._s(e.maximumStepsCount-e.stepsCount)+" ")]),n("div",{staticClass:"timer"},[e._v(" –í—Ä–µ–º—è –æ–±—É—á–µ–Ω–∏—è: "+e._s(e.timer)+" —Å–µ–∫—É–Ω–¥ (~"+e._s(Math.round(e.timer/60))+" –º–∏–Ω—É—Ç) ")]),n("div",{staticClass:"lives"},[e._v(" –°—ã–≥—Ä–∞–Ω–æ –∂–∏–∑–Ω–µ–π: "+e._s(e.lives)+" ")]),n("div",{staticClass:"actors-container"},[n("div",{staticClass:"title"},[e._v(" –°–æ–±—Ä–∞–Ω–æ —è–±–ª–æ–∫ –∑–∞ –∂–∏–∑–Ω—å ")]),e._l(Object.values(e.actors),(function(t){return n("div",{key:t.name,staticClass:"actor"},[n("div",{staticClass:"name",style:{color:t.colorHead}},[e._v(" "+e._s(t.name)+": ")]),e.stats[t.name]?n("div",{staticClass:"stats",style:{color:t.colorHead}},[e._v(" "+e._s(e.stats[t.name].maxApples)+" ")]):e._e()])}))],2)]),n("div",{staticClass:"field"},e._l(e.field,(function(t,i){return n("div",{key:i,staticClass:"row"},e._l(t,(function(e,t){return n("div",{key:i+"_"+t,staticClass:"cell",style:{backgroundColor:e}})})),0)})),0)])},K=[],W=(n("cb29"),n("7db0"),n("caad"),n("b64b"),n("07ac"),n("2532"),n("e1bd")),U=n("9675"),Q=n.n(U),Z="#111",ee="#222",te="green",ne=["rgba(201, 52, 65, 1.0)","rgba(201, 52, 65, 0.5)","rgba(34, 95, 228, 1.0)","rgba(34, 95, 228, 0.5)"],ie=[].concat(ne,[Z]),ae={KeyW:"stepTop",KeyD:"stepRight",KeyS:"stepBottom",KeyA:"stepLeft"},re={0:"stepTop",1:"stepRight",2:"stepBottom",3:"stepLeft"},se={stepTop:0,stepRight:1,stepBottom:2,stepLeft:3},oe=Object.keys(re).length,ce=!1,le=50,ue=60,pe=2.5,de=1,me=1,fe=2e3,ve=1,he=-.9,ge=-.9,be=.1,xe=.9,we=.9,ye=.9,Oe=1.1,_e=!1,ke=-1,Te={center:[{id:Object(W["a"])(),position:{y:9,x:7}},{id:Object(W["a"])(),position:{y:9,x:8}},{id:Object(W["a"])(),position:{y:8,x:8}},{id:Object(W["a"])(),position:{y:7,x:8}},{id:Object(W["a"])(),position:{y:7,x:7}}],topLeft:[{id:Object(W["a"])(),position:{y:7,x:3}},{id:Object(W["a"])(),position:{y:6,x:3}},{id:Object(W["a"])(),position:{y:5,x:3}},{id:Object(W["a"])(),position:{y:4,x:3}},{id:Object(W["a"])(),position:{y:3,x:3}}],topRight:[{id:Object(W["a"])(),position:{y:3,x:ue-8}},{id:Object(W["a"])(),position:{y:3,x:ue-7}},{id:Object(W["a"])(),position:{y:3,x:ue-6}},{id:Object(W["a"])(),position:{y:3,x:ue-5}},{id:Object(W["a"])(),position:{y:3,x:ue-4}}],bottomRight:[{id:Object(W["a"])(),position:{y:ue-8,x:ue-4}},{id:Object(W["a"])(),position:{y:ue-7,x:ue-4}},{id:Object(W["a"])(),position:{y:ue-6,x:ue-4}},{id:Object(W["a"])(),position:{y:ue-5,x:ue-4}},{id:Object(W["a"])(),position:{y:ue-4,x:ue-4}}],bottomLeft:[{id:Object(W["a"])(),position:{y:ue-4,x:7}},{id:Object(W["a"])(),position:{y:ue-4,x:6}},{id:Object(W["a"])(),position:{y:ue-4,x:5}},{id:Object(W["a"])(),position:{y:ue-4,x:4}},{id:Object(W["a"])(),position:{y:ue-4,x:3}}]},Re={name:"Snake",data:function(){return{field:[[]],fieldDefault:[[]],fieldSize:ue,actors:{human:{name:"human",side:"stepBottom",colorHead:ne[0],colorTail:ne[1],cells:Q()(Te.topLeft),model:b["c"](),training:{inputs:[],labels:[]},rewards:Array(oe).fill(be)}},actorsDefault:{},stats:{},stepsCount:0,maximumStepsCount:ue*pe,timer:0,lives:0,everyLives:300,apples:[],mode:ce?"gaming":"training",isRunning:!0}},mounted:function(){var e=2;console.log(e),this.incrementTimer(),this.initialField(),this.initialApples(),this.initialActors(),this.initialStats(),this.autoStep(),window.addEventListener("keydown",this.handleKeys)},destroyed:function(){window.removeEventListener("keydown",this.handleKeys)},methods:{incrementTimer:function(){setTimeout(this.incrementTimer,1e3),this.timer+=1},initialField:function(){for(var e=Array(ue),t=0;t<ue;t+=1){e[t]=Array(ue);for(var n=0;n<ue;n+=1){var i=t<=0||t>=ue-1||n<=0||n>=ue-1;e[t][n]=i?Z:ee}}this.field=e,this.fieldDefault=Q()(this.field)},initialApples:function(){for(var e=0;e<de;e+=1)this.apples.push({y:-1,x:-1});this.apples.forEach(this.addApple)},addApple:function(e){var t=Math.round(Math.random()*(ue-1)),n=Math.round(Math.random()*(ue-1));this.field[t][n]===ee?(e.y=t,e.x=n,this.field[t][n]=te):this.addApple(e)},initialActors:function(){Object.values(this.actors).forEach(this.setupModel),this.actorsDefault=Q()(this.actors),this.resetActors()},resetActors:function(){var e=this;Object.values(this.actors).forEach((function(t){t.cells.forEach((function(n,i){var a=n.position,r=a.y,s=a.x;e.field[r][s]=0===i?t.colorHead:t.colorTail})),e.resetRewards(t)}))},resetRewards:function(e){e.rewards=e.rewards.map((function(){return be}))},initialStats:function(){var e=this;Object.values(this.actors).forEach((function(t){e.stats[t.name]={apples:0,maxApples:0}}))},resetStats:function(){var e=this;Object.values(this.actors).forEach((function(t){e.stats[t.name].apples=0}))},chooseActorsPosition:function(){var e=Object.keys(Te),t=e[Math.round((e.length-1)*Math.random())];Object.values(this.actors).forEach((function(e){e.cells=Q()(Te[t])}))},handleKeys:function(e){var t=e.code,n=ae[t];n&&(this.mode="gaming",this.actors.human.side=n)},autoStep:function(){var e=this;return Object(g["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!e.isRunning){t.next=3;break}return t.next=3,e.modelsPredicts();case 3:"training"===e.mode?ke=requestAnimationFrame(e.autoStep):"gaming"===e.mode&&(ke=setTimeout(e.autoStep,le));case 4:case"end":return t.stop()}}),t)})))()},step:function(e){this.clearTail(e),this.stepTail(e),this.stepHead(e)},clearTail:function(e){var t=e.cells,n=t[t.length-1].position,i=n.y,a=n.x;this.field[i][a]=ee},stepTail:function(e){for(var t=e.cells.length-1;t>0;t-=1){var n=e.cells[t];n.position=e.cells[t-1].position;var i=n.position,a=i.y,r=i.x;this.field[a][r]=e.colorTail}},stepHead:function(e){var t=Object(h["a"])(e.cells,1),n=t[0],i=this[e.side](n.position),a=i.y,r=i.x;this.nextCell({actor:e,cellHead:n,y:a,x:r})},stepTop:function(e){var t=e.y,n=e.x;return{y:t-1,x:n}},stepRight:function(e){var t=e.y,n=e.x;return{y:t,x:n+1}},stepBottom:function(e){var t=e.y,n=e.x;return{y:t+1,x:n}},stepLeft:function(e){var t=e.y,n=e.x;return{y:t,x:n-1}},nextCell:function(e){var t=e.actor,n=e.cellHead,i=e.y,a=e.x,r=this.field[i][a];if(ie.includes(r))this.preserveExperience({type:"decrease",actor:t}),this.gameOver();else if(r===te){this.preserveExperience({type:"increase",actor:t}),this.growth({actor:t,y:i,x:a}),this.applyNextCell({actor:t,cellHead:n,y:i,x:a});var s=this.apples.find((function(e){return"".concat(e.y,"_").concat(e.x)==="".concat(i,"_").concat(a)}));this.addApple(s),this.appleFit()}else this.preserveExperience({type:"pass",actor:t}),this.applyNextCell({actor:t,cellHead:n,y:i,x:a})},applyNextCell:function(e){var t=e.actor,n=e.cellHead,i=e.y,a=e.x;n.position={y:i,x:a},this.field[i][a]=t.colorHead},growth:function(e){var t=e.actor,n=e.y,i=e.x;this.stats[t.name].apples+=1,this.stats[t.name].apples>this.stats[t.name].maxApples&&(this.stats[t.name].maxApples=this.stats[t.name].apples),this.stepsCount=0,t.cells.push({id:Object(W["a"])(),position:{y:n,x:i}})},gameOver:function(){var e=this;this.isRunning=!1,this.stepsCount=0,cancelAnimationFrame(ke),clearTimeout(ke),ke=-1,this.modelFit((function(){e.field=Q()(e.fieldDefault),e.actors=Q()(e.actorsDefault),e.resetActors(),e.resetStats(),e.apples.forEach(e.addApple),e.mode=ce?"gaming":"training",e.isRunning=!0}))},setupModel:function(e){var t=e.model;t.add(b["a"].dense({inputShape:[oe+oe+1+1],activation:"relu",units:fe}));for(var n=0;n<me;n+=1)t.add(b["a"].dense({activation:"relu",units:fe}));t.add(b["a"].dense({activation:"sigmoid",units:oe})),t.compile({optimizer:"adam",loss:"meanSquaredError"})},modelsPredicts:function(){var e=this;return Object(g["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Promise.all(Object.values(e.actors).map((function(t){return Object(g["a"])(regeneratorRuntime.mark((function n(){var i;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if("gaming"!==e.mode||"human"!==t.name){n.next=5;break}return n.next=3,e.modelPredict(t);case 3:n.next=9;break;case 5:return n.next=7,e.modelPredict(t);case 7:i=n.sent,t.side=re[i];case 9:e.step(t);case 10:case"end":return n.stop()}}),n)})))()})));case 2:e.stepsCount+=1,e.stepsCount===e.maximumStepsCount&&e.gameOver();case 4:case"end":return t.stop()}}),t)})))()},modelPredict:function(e){var t=this;return Object(g["a"])(regeneratorRuntime.mark((function n(){var i,a,r;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return i=t.assessment(e),t.whichSidesOfApples(e),a=i.concat(e.rewards),n.next=5,e.model.predict(b["d"]([a])).data();case 5:return r=n.sent,n.abrupt("return",r.indexOf(Math.max.apply(Math,Object(v["a"])(r))));case 7:case"end":return n.stop()}}),n)})))()},assessment:function(e){var t=this,n=Object(h["a"])(e.cells,1),i=n[0].position,a=[];return Object.keys(se).forEach((function(e){var n=t[e]({y:i.y,x:i.x}),r=n.y,s=n.x,o=t.field[r][s];ie.includes(o)?a.push(he):o===te?a.push(we):a.push(xe)})),a.push(this.getDippedAppleReward(i)),a.push(this.estimateNumberMoves()),a},getDippedAppleReward:function(e){var t=this,n=0;return this.apples.forEach((function(i){var a=t.distanceToApple({apple:i,actorHead:e}),r=(ue-(a+1))/ue;r>n&&(n=r)})),n},distanceToApple:function(e){var t=e.apple,n=e.actorHead,i=Math.pow(t.x-n.x,2),a=Math.pow(t.y-n.y,2);return Math.sqrt(i+a)},estimateNumberMoves:function(){var e=.5*ue;if((e-this.stepsCount)/e>0)return we;if((ue-this.stepsCount)/ue>0)return xe;var t=1.5*ue;return(t-this.stepsCount)/t>0?be:ge},preserveExperience:function(e){var t=e.type,n=e.actor,i=this.assessment(n);this.whichSidesOfApples(n);var a=i.concat(n.rewards);n.training.inputs.push(a),n.training.labels.push(n.rewards),"decrease"===t?(n.training.inputs=n.training.inputs.map((function(e){return e.map((function(e){return e*ye}))})),n.training.labels=n.training.labels.map((function(e){return e.map((function(e){return e*ye}))}))):"increase"===t&&(n.training.inputs=n.training.inputs.map((function(e){return e.map((function(e){return e*Oe}))})),n.training.labels=n.training.labels.map((function(e){return e.map((function(e){return e*Oe}))}))),this.resetRewards(n)},whichSidesOfApples:function(e){var t=this,n=Object(h["a"])(e.cells,1),i=n[0].position;this.apples.forEach((function(n){n.x===i.x?t.appleOnAxisX({apple:n,actor:e,actorHead:i}):n.y===i.y?t.appleOnAxisY({apple:n,actor:e,actorHead:i}):n.y<i.y?t.appleBelowAxisY({apple:n,actor:e,actorHead:i}):n.y>i.y&&t.appleAboveAxisY({apple:n,actor:e,actorHead:i})}))},appleOnAxisX:function(e){var t=e.apple,n=e.actor,i=e.actorHead;t.y<i.y?this.appleTop(n):t.y>i.y&&this.appleBottom(n)},appleTop:function(e){e.rewards[se.stepTop]=we,e.rewards[se.stepBottom]=he},appleBottom:function(e){e.rewards[se.stepBottom]=we,e.rewards[se.stepTop]=he},appleOnAxisY:function(e){var t=e.apple,n=e.actor,i=e.actorHead;t.x>i.x?this.appleRight(n):t.x<i.x&&this.appleLeft(n)},appleRight:function(e){e.rewards[se.stepRight]=we,e.rewards[se.stepLeft]=he},appleLeft:function(e){e.rewards[se.stepLeft]=we,e.rewards[se.stepRight]=he},appleBelowAxisY:function(e){var t=e.apple,n=e.actor,i=e.actorHead;t.x<i.x?this.appleTopLeft(n):t.x>i.x&&this.appleTopRight(n)},appleTopLeft:function(e){e.rewards[se.stepTop]=xe,e.rewards[se.stepLeft]=xe,e.rewards[se.stepRight]=ge,e.rewards[se.stepBottom]=ge},appleTopRight:function(e){e.rewards[se.stepTop]=xe,e.rewards[se.stepRight]=xe,e.rewards[se.stepBottom]=ge,e.rewards[se.stepLeft]=ge},appleAboveAxisY:function(e){var t=e.apple,n=e.actor,i=e.actorHead;t.x>i.x?this.appleBottomRight(n):t.x<i.x&&this.appleBottomLeft(n)},appleBottomRight:function(e){e.rewards[se.stepRight]=xe,e.rewards[se.stepBottom]=xe,e.rewards[se.stepTop]=ge,e.rewards[se.stepLeft]=ge},appleBottomLeft:function(e){e.rewards[se.stepBottom]=xe,e.rewards[se.stepLeft]=xe,e.rewards[se.stepTop]=ge,e.rewards[se.stepRight]=ge},appleFit:function(){var e=this;this.isRunning=!1,cancelAnimationFrame(ke),clearTimeout(ke),ke=-1,this.modelFit((function(){e.mode=ce?"gaming":"training",e.isRunning=!0}))},modelFit:function(e){_e||(_e=!0,this.lives+=1,Promise.all(Object.values(this.actors).map(function(){var e=Object(g["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!(t.training.labels.length>0)){e.next=5;break}return e.next=3,t.model.fit(b["d"](t.training.inputs),b["d"](t.training.labels),{epochs:ve});case 3:t.training.inputs=[],t.training.labels=[];case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())).then(Object(g["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:_e=!1,e();case 2:case"end":return t.stop()}}),t)})))))}}},Se=Re,Ce=(n("c7d7"),Object(l["a"])(Se,Y,K,!1,null,"65028fbc",null)),je=Ce.exports;i["a"].use(a["a"]),i["a"].config.productionTip=!1,i["a"].config.silent=!0,new i["a"]({name:"App",render:function(e){return e(p)},router:new a["a"]({routes:[{path:"/",name:"App",meta:{isReload:!1},component:p,redirect:{name:"TicTacToe"}},{path:"/TicTacToe",name:"TicTacToe",meta:{isReload:!0},component:P},{path:"/Square",name:"Square",meta:{isReload:!0},component:$},{path:"/Snake",name:"Snake",meta:{isReload:!0},component:je}]})}).$mount("#app")},"6cda":function(e,t,n){},8665:function(e,t,n){},c7d7:function(e,t,n){"use strict";var i=n("553a"),a=n.n(i);a.a},e526:function(e,t,n){"use strict";var i=n("40b2"),a=n.n(i);a.a},e867:function(e,t,n){"use strict";var i=n("8665"),a=n.n(i);a.a}});
//# sourceMappingURL=app.7a04a3fa.js.map